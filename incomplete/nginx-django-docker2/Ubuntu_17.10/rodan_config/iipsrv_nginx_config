# Nginx configuration for serving IIPSRV on port 9003 by proxying HTTP requests to the IIPSRV FastCGI application that
# should be running from the command line bound to /tmp/iipserver_1.sock. Copy this file to /etc/nginx/sites-available
# and link it to /etc/nginx/sites-enabled to enable it.
# Example command to run IIPSRV:
# JPEG_QUALITY='100' MAX_LAYERS='4' MAX_CVT='7000' FILESYSTEM_PREFIX='/rodan/data/' \
#   su -s /bin/bash -c "/vendor/iipsrv/src/iipsrv.fcgi --bind /tmp/iipserver_1.sock &" www-data

upstream iip {
    server unix:/tmp/iipserver_1.sock fail_timeout=0;
}

server {
    listen 9003;
    server_name localhost;
    client_max_body_size 200M;
    error_log /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;

    location /fcgi-bin/iipsrv.fcgi {
        fastcgi_pass    iip;
        fastcgi_param   PATH_INFO $fastcgi_script_name;
        fastcgi_param   REQUEST_METHOD $request_method;
        fastcgi_param   QUERY_STRING $query_string;
        fastcgi_param   CONTENT_TYPE $content_type;
        fastcgi_param   CONTENT_LENGTH $content_length;
        add_header 'Access-Control-Allow-Origin' '*';
    }
}
